angular.module("dias.label-trees",["dias.api","dias.ui"]),angular.module("dias.label-trees").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("dias.label-trees").directive("labelTreeItem",["$compile","$timeout","$templateCache",function(e,n,i){"use strict";return{restrict:"C",templateUrl:"label-item.html",scope:!0,link:function(t,r,o){var l=angular.element(i.get("label-subtree.html"));n(function(){r.append(e(l)(t))})},controller:["$scope",function(e){var n=!1,i=!1,t=!1,r=function(){-1!==e.openHierarchy.indexOf(e.item.id)?n=!0:e.selected.label&&e.selected.label.id===e.item.id?(n=!0,t=!0):(n=!1,t=!1)},o=function(){i=e.tree&&!!e.tree[e.item.id]};e.getSubtree=function(){return n?e.tree[e.item.id]:[]},e.getClass=function(){return{open:n,expandable:i,selected:t}},e.$on("labels.selected",r),e.$on("labels.refresh",o),r(),o()}]}}]),angular.module("dias.label-trees").controller("AuthorizedProjectsController",["$scope","LABEL_TREE","AUTH_PROJECTS","AUTH_OWN_PROJECTS","Project","LabelTreeAuthorizedProject",function(e,n,i,t,r,o){"use strict";var l=!1,a=!1,u=null,d=null,c=function(e){for(var n=i.length-1;n>=0;n--)if(i[n].id===e.id)return!1;return!0},s=function(e){d=e.filter(c)},f=function(e){msg.responseError(e),a=!1},b=function(e){i.push(e),t.push(e.id),s(u),a=!1},m=function(e){var n;for(n=i.length-1;n>=0;n--)if(i[n].id===e.id){i.splice(n,1);break}n=t.indexOf(e.id),-1!==n&&t.splice(n,1),s(u),a=!1};e.hasProjects=function(){return i.length>0},e.getProjects=function(){return i},e.isOwnProject=function(e){return-1!==t.indexOf(e.id)},e.isEditing=function(){return l},e.getVisibilityId=function(){return n.visibility_id},e.toggleEditing=function(){u||(u=r.query(s)),l=!l},e.isLoading=function(){return a},e.getProjectsForAuthorization=function(){return d},e.addAuthorizedProject=function(e){a=!0,o.addAuthorized({id:n.id},{id:e.id},function(){b(e)},f)},e.removeAuthorizedProject=function(e){a=!0,o.removeAuthorized({id:n.id},{id:e.id},function(){m(e)},f)}}]),angular.module("dias.label-trees").controller("LabelTreeController",["$scope","LABEL_TREE","LabelTree","msg","$timeout","LabelTreeUser","USER_ID","REDIRECT_URL",function(e,n,i,t,r,o,l,a){"use strict";var u=!1,d=!1;e.labelTreeInfo={name:n.name,description:n.description,visibility_id:n.visibility_id.toString()};var c=function(e){meg.responseError(e),d=!1},s=function(e){n.name=e.name,n.description=e.description,n.visibility_id=parseInt(e.visibility_id),u=!1,d=!1},f=function(){t.success("The label tree was deleted. Redirecting..."),r(function(){window.location.href=a},2e3)},b=function(e){e?(t.success("You left the label tree. Redirecting..."),r(function(){window.location.href=a},2e3)):(t.success("You left the label tree. Reloading..."),r(function(){window.location.reload()},2e3))};e.isEditing=function(){return u},e.toggleEditing=function(){u=!u},e.isSaving=function(){return d},e.getVisibilityId=function(){return n.visibility_id},e.getName=function(){return n.name},e.getDescription=function(){return n.description},e.saveChanges=function(){d=!0,i.update({id:n.id,name:e.labelTreeInfo.name,description:e.labelTreeInfo.description,visibility_id:parseInt(e.labelTreeInfo.visibility_id)},s,c)},e.discardChanges=function(){e.labelTreeInfo.name=n.name,e.labelTreeInfo.description=n.description,e.labelTreeInfo.visibility_id=n.visibility_id.toString(),u=!1},e.deleteTree=function(){confirm("Do you really want to delete the label tree "+n.name+"?")&&i["delete"]({id:n.id},f,t.responseError)},e.leaveTree=function(e){confirm("Do you really want to leave the label tree "+n.name+"?")&&o.detach({label_tree_id:n.id},{id:l},function(){b(e)},t.responseError)}}]),angular.module("dias.label-trees").controller("LabelsController",["$scope","LABELS","LABEL_TREE","Label","msg",function(e,n,i,t,r){"use strict";var o=!1,l=!1,a={LABEL:null,COLOR:"#0099ff",NAME:""};e.tree={},e.selected={label:a.LABEL,color:a.COLOR,name:a.NAME},e.openHierarchy=[];var u=function(e){r.responseError(e),l=!1},d=function(){e.tree={},n.forEach(function(n){var i=n.parent_id;e.tree[i]?e.tree[i].push(n):e.tree[i]=[n]})},c=function(i){n.push(i),d(),e.$broadcast("labels.refresh"),e.resetName(),l=!1},s=function(i){for(var t=n.length-1;t>=0;t--)if(n[t].id===i.id){n.splice(t,1);break}d(),e.selected.label&&e.selected.label.id===i.id&&(e.selected.label=null),e.selectLabel(e.selected.label),l=!1},f=function(e){for(var i=n.length-1;i>=0;i--)if(n[i].id===e)return n[i];return null},b=function(n){var i=n;if(e.openHierarchy.length=0,i)for(;null!==i.parent_id;)e.openHierarchy.unshift(i.parent_id),i=f(i.parent_id)};e.selectLabel=function(n){b(n),e.selected.label=n,e.$broadcast("labels.selected")},e.hasLabels=function(){return n.length>0},e.isEditing=function(){return o},e.toggleEditing=function(){o=!o},e.getLabels=function(){return n},e.resetParent=function(){e.selectLabel(a.LABEL)},e.resetColor=function(){e.selected.color=a.COLOR},e.resetName=function(){e.selected.name=a.NAME},e.addLabel=function(){l=!0;var n={name:e.selected.name,color:e.selected.color,label_tree_id:i.id};e.selected.label&&(n.parent_id=e.selected.label.id),t.create(n,c,u)},e.removeLabel=function(e,n){l=!0,n.stopPropagation(),t["delete"]({id:e.id},function(){s(e)},u)},e.isLoading=function(){return l},d()}]),angular.module("dias.label-trees").controller("MembersController",["$scope","LABEL_TREE","MEMBERS","ROLES","DEFAULT_ROLE_ID","USER_ID","LabelTreeUser","msg","User",function(e,n,i,t,r,o,l,a,u){"use strict";var d=!1,c=!1;e.newMember={user:null,role_id:r.toString()};var s=function(e){a.responseError(e),c=!1},f=function(e){e.role_id=parseInt(e.tmp_role_id),c=!1},b=function(e,n){e.tmp_role_id=e.role_id.toString(),s(n)},m=function(e){for(var n=i.length-1;n>=0;n--)if(i[n].id===e.id){i.splice(n,1);break}c=!1},g=function(e){for(var n=i.length-1;n>=0;n--)if(i[n].id===e.id)return!1;return!0},p=function(e){return e.filter(g)},_=function(n){n.tmp_role_id=n.role_id.toString(),i.push(n),e.newMember.user=null,c=!1};e.isEditing=function(){return d},e.toggleEditing=function(){d=!d},e.isLoading=function(){return c},e.getMembers=function(){return i},e.hasMembers=function(){return i.length>0},e.getRoles=function(){return t},e.getRole=function(e){return t[e]},e.isOwnUser=function(e){return o===e.id},e.updateRole=function(e){c=!0,l.update({label_tree_id:n.id},{id:e.id,role_id:parseInt(e.tmp_role_id)},function(){f(e)},function(n){b(e,n)})},e.detachMember=function(e){c=!0,l.detach({label_tree_id:n.id},{id:e.id},function(){m(e)},s)},e.username=function(e){return e&&e.firstname&&e.lastname?e.firstname+" "+e.lastname:""},e.findUser=function(e){return u.find({query:encodeURIComponent(e)}).$promise.then(p)},e.newMemberValid=function(){return e.newMember.user&&void 0!==e.newMember.user.id&&g(e.newMember.user)&&null!==e.newMember.role_id},e.attachMember=function(){if(e.newMemberValid()){c=!0;var i=e.newMember.user;i.role_id=parseInt(e.newMember.role_id),l.attach({label_tree_id:n.id},{id:i.id,role_id:i.role_id},function(){_(i)},s)}};for(var h=i.length-1;h>=0;h--)i[h].tmp_role_id=i[h].role_id.toString()}]);