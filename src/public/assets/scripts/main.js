angular.module("dias.label-trees",["dias.api","dias.ui"]),angular.module("dias.label-trees").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("dias.label-trees").directive("labelTreeItem",["$compile","$timeout","$templateCache",function(e,t,n){"use strict";return{restrict:"C",templateUrl:"label-item.html",scope:!0,link:function(r,l,i){var o=angular.element(n.get("label-subtree.html"));t(function(){l.append(e(o)(r))})},controller:["$scope",function(e){var t=function(){return e.tree&&!!e.tree[e.item.id]},n=!1,r=t(),l=!1;e.getClass=function(){return{open:n,expandable:r,selected:l}},e.$on("labels.selected",function(t,r){e.item.id===r?(n=!0,l=!0,e.$emit("labels.openParents")):(n=!1,l=!1)}),e.$on("labels.openParents",function(t){n=!0,null===e.item.parent_id&&t.stopPropagation()}),e.$on("labels.refresh",function(){r=t()})}]}}]),angular.module("dias.label-trees").controller("AuthorizedProjectsController",["$scope","LABEL_TREE_ID","AUTH_PROJECTS","AUTH_OWN_PROJECTS","Project","LabelTreeAuthorizedProject",function(e,t,n,r,l,i){"use strict";var o=!1,a=!1,c=null,u=null,s=function(e){for(var t=n.length-1;t>=0;t--)if(n[t].id===e.id)return!1;return!0},d=function(e){u=e.filter(s)},f=function(e){msg.responseError(e),a=!1},b=function(e){n.push(e),r.push(e.id),d(c),a=!1},g=function(e){var t;for(t=n.length-1;t>=0;t--)if(n[t].id===e.id){n.splice(t,1);break}t=r.indexOf(e.id),-1!==t&&r.splice(t,1),d(c),a=!1};e.hasProjects=function(){return n.length>0},e.getProjects=function(){return n},e.isOwnProject=function(e){return-1!==r.indexOf(e.id)},e.isEditing=function(){return o},e.toggleEditing=function(){c||(c=l.query(d)),o=!o},e.isLoading=function(){return a},e.getProjectsForAuthorization=function(){return u},e.addAuthorizedProject=function(e){a=!0,i.addAuthorized({id:t},{id:e.id},function(){b(e)},f)},e.removeAuthorizedProject=function(e){a=!0,i.removeAuthorized({id:t},{id:e.id},function(){g(e)},f)}}]),angular.module("dias.label-trees").controller("LabelTreeController",["$scope","LABELS","LABEL_TREE_ID","Label","msg",function(e,t,n,r,l){"use strict";var i=!1,o=!1,a={LABEL:null,COLOR:"#0099ff",NAME:""};e.tree={},e.selected={label:a.LABEL,color:a.COLOR,name:a.NAME};var c=function(e){l.responseError(e),o=!1},u=function(){e.tree={},t.forEach(function(t){var n=t.parent_id;e.tree[n]?e.tree[n].push(t):e.tree[n]=[t]})},s=function(n){t.push(n),u(),e.$broadcast("labels.refresh"),e.resetName(),o=!1},d=function(n){for(var r=t.length-1;r>=0;r--)if(t[r].id===n.id){t.splice(r,1);break}u(),e.selected.label&&e.selected.label.id===n.id&&(e.selected.label=null),e.selectLabel(e.selected.label),o=!1};e.selectLabel=function(t){e.selected.label=t,e.$broadcast("labels.selected",t?t.id:null)},e.hasLabels=function(){return t.length>0},e.isEditing=function(){return i},e.toggleEditing=function(){i=!i},e.getLabels=function(){return t},e.resetParent=function(){e.selectLabel(a.LABEL)},e.resetColor=function(){e.selected.color=a.COLOR},e.resetName=function(){e.selected.name=a.NAME},e.addLabel=function(){o=!0;var t={name:e.selected.name,color:e.selected.color,label_tree_id:n};e.selected.label&&(t.parent_id=e.selected.label.id),r.create(t,s,c)},e.removeLabel=function(e,t){o=!0,t.stopPropagation(),r["delete"]({id:e.id},function(){d(e)},c)},e.isLoading=function(){return o},u()}]);