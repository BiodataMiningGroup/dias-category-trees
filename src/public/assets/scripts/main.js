angular.module("dias.label-trees",["dias.api","dias.ui"]),angular.module("dias.label-trees").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("dias.label-trees").controller("AuthorizedProjectsController",["$scope","LABEL_TREE_ID","AUTH_PROJECTS","AUTH_OWN_PROJECTS","Project","LabelTreeAuthorizedProject",function(e,n,t,r,i,o){"use strict";var l=!1,u=!1,a=null,c=null,d=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id)return!1;return!0},s=function(e){c=e.filter(d)},f=function(e){msg.responseError(e),u=!1},b=function(e){t.push(e),r.push(e.id),s(a),u=!1},m=function(e){var n;for(n=t.length-1;n>=0;n--)if(t[n].id===e.id){t.splice(n,1);break}n=r.indexOf(e.id),-1!==n&&r.splice(n,1),s(a),u=!1};e.hasProjects=function(){return t.length>0},e.getProjects=function(){return t},e.isOwnProject=function(e){return-1!==r.indexOf(e.id)},e.isEditing=function(){return l},e.toggleEditing=function(){a||(a=i.query(s)),l=!l},e.isLoading=function(){return u},e.getProjectsForAuthorization=function(){return c},e.addAuthorizedProject=function(e){u=!0,o.addAuthorized({id:n},{id:e.id},function(){b(e)},f)},e.removeAuthorizedProject=function(e){u=!0,o.removeAuthorized({id:n},{id:e.id},function(){m(e)},f)}}]),angular.module("dias.label-trees").controller("LabelTreeController",["$scope","LABELS","LABEL_TREE_ID","Label","msg",function(e,n,t,r,i){"use strict";var o=!1,l=!1,u={LABEL:null,COLOR:"#0099ff",NAME:""};e.tree={},e.selected={label:u.LABEL,color:u.COLOR,name:u.NAME};var a=function(e){i.responseError(e),l=!1},c=function(){e.tree={},n.forEach(function(n){var t=n.parent_id;e.tree[t]?e.tree[t].push(n):e.tree[t]=[n]})},d=function(t){n.push(t),c(),e.$broadcast("labels.refresh"),e.resetName(),l=!1},s=function(t){for(var r=n.length-1;r>=0;r--)if(n[r].id===t.id){n.splice(r,1);break}c(),e.selected.label&&e.selected.label.id===t.id&&(e.selected.label=null),e.selectLabel(e.selected.label),l=!1};e.selectLabel=function(n){e.selected.label=n,e.$broadcast("labels.selected",n?n.id:null)},e.hasLabels=function(){return n.length>0},e.isEditing=function(){return o},e.toggleEditing=function(){o=!o},e.getLabels=function(){return n},e.resetParent=function(){e.selectLabel(u.LABEL)},e.resetColor=function(){e.selected.color=u.COLOR},e.resetName=function(){e.selected.name=u.NAME},e.addLabel=function(){l=!0;var n={name:e.selected.name,color:e.selected.color,label_tree_id:t};e.selected.label&&(n.parent_id=e.selected.label.id),r.create(n,d,a)},e.removeLabel=function(e,n){l=!0,n.stopPropagation(),r["delete"]({id:e.id},function(){s(e)},a)},e.isLoading=function(){return l},c()}]),angular.module("dias.label-trees").controller("MembersController",["$scope","LABEL_TREE_ID","MEMBERS","ROLES","USER_ID","LabelTreeUser","msg","User",function(e,n,t,r,i,o,l,u){"use strict";var a=!1,c=!1;e.newMember={user:null,role_id:null};var d=function(e){l.responseError(e),c=!1},s=function(e){e.role_id=parseInt(e.tmp_role_id),c=!1},f=function(e,n){e.tmp_role_id=e.role_id.toString(),d(n)},b=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id){t.splice(n,1);break}c=!1},m=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id)return!1;return!0},g=function(e){return e.filter(m)},p=function(n){n.tmp_role_id=n.role_id.toString(),t.push(n),e.newMember.user=null,c=!1};e.isEditing=function(){return a},e.toggleEditing=function(){a=!a},e.isLoading=function(){return c},e.getMembers=function(){return t},e.getRoles=function(){return r},e.getRole=function(e){return r[e]},e.isOwnUser=function(e){return i===e.id},e.updateRole=function(e){c=!0,o.update({label_tree_id:n},{id:e.id,role_id:parseInt(e.tmp_role_id)},function(){s(e)},function(n){f(e,n)})},e.detachMember=function(e){c=!0,o.detach({label_tree_id:n},{id:e.id},function(){b(e)},d)},e.username=function(e){return e&&e.firstname&&e.lastname?e.firstname+" "+e.lastname:""},e.findUser=function(e){return u.find({query:encodeURIComponent(e)}).$promise.then(g)},e.newMemberValid=function(){return e.newMember.user&&void 0!==e.newMember.user.id&&m(e.newMember.user)&&null!==e.newMember.role_id},e.attachMember=function(){if(e.newMemberValid()){c=!0;var t=e.newMember.user;t.role_id=parseInt(e.newMember.role_id),o.attach({label_tree_id:n},{id:t.id,role_id:t.role_id},function(){p(t)},d)}};for(var _=t.length-1;_>=0;_--)t[_].tmp_role_id=t[_].role_id.toString()}]),angular.module("dias.label-trees").directive("labelTreeItem",["$compile","$timeout","$templateCache",function(e,n,t){"use strict";return{restrict:"C",templateUrl:"label-item.html",scope:!0,link:function(r,i,o){var l=angular.element(t.get("label-subtree.html"));n(function(){i.append(e(l)(r))})},controller:["$scope",function(e){var n=function(){return e.tree&&!!e.tree[e.item.id]},t=!1,r=n(),i=!1;e.getClass=function(){return{open:t,expandable:r,selected:i}},e.$on("labels.selected",function(n,r){e.item.id===r?(t=!0,i=!0,e.$emit("labels.openParents")):(t=!1,i=!1)}),e.$on("labels.openParents",function(n){t=!0,null===e.item.parent_id&&n.stopPropagation()}),e.$on("labels.refresh",function(){r=n()})}]}}]);